<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Online Party Chat</title>
<style>
body { margin:0; background:#0f0f0f; color:white; font-family:Arial,sans-serif; display:flex; flex-direction:column; height:100vh; }
#chat-box { flex:1; overflow-y:auto; padding:10px; border-bottom:1px solid #333; }
#chat-box div { margin:5px 0; }
#input-area { display:flex; padding:10px; background:#1a1a1a; }
#username, #party-code, #message, #party-type { background:#222; border:none; color:white; padding:10px; margin-right:5px; border-radius:5px; }
#username { width:120px; }
#party-code { width:100px; }
#message { flex:1; }
#send, #create, #join, #join-random { background:#444; border:none; color:white; padding:10px 15px; border-radius:5px; cursor:pointer; }
#send:hover, #create:hover, #join:hover, #join-random:hover { background:#666; }
</style>
</head>
<body>

<div>
Username: <input type="text" id="username" placeholder="Username">
Party Type: 
<select id="party-type">
  <option value="public">Public</option>
  <option value="private">Private</option>
</select>
Party Code: <input type="text" id="party-code" placeholder="Party Code">
<button id="create">Create Party</button>
<button id="join">Join Party</button>
<button id="join-random">Join Random</button>
</div>

<div id="chat-box"></div>

<div id="input-area">
<input type="text" id="message" placeholder="Type a message...">
<button id="send">Send</button>
</div>

<script>
// --- Config ---
const filterWords = ["badword","foo","bar"];
const ws = new WebSocket("wss://echo.websocket.events"); // Public echo server
const messageSound = new Audio("https://www.soundjay.com/button/beep-07.mp3"); // short beep on message

let username = "";
let party = null;
let partyType = "public";
let partyMembers = [];
let partyMessages = [];
let publicRooms = [];

// --- Elements ---
const chatBox = document.getElementById("chat-box");
const usernameInput = document.getElementById("username");
const partyInput = document.getElementById("party-code");
const partyTypeSelect = document.getElementById("party-type");
const messageInput = document.getElementById("message");

// --- Helper ---
function appendMessage(text){
  let filtered = text.split(" ").map(w => filterWords.includes(w.toLowerCase()) ? "***" : w).join(" ");
  const div = document.createElement("div");
  div.textContent = filtered;
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
}

function playMessageSound(){
  messageSound.currentTime = 0;
  messageSound.play();
}

function broadcastParty(){
  if(!party) return;
  const payload = JSON.stringify({
    type: "partyUpdate",
    party,
    partyType,
    members: partyMembers,
    messages: partyMessages
  });
  ws.send(payload);
  if(partyType==="public"){
    ws.send(JSON.stringify({type:"roomAnnounce", party}));
  }
}

function loadPartyData(data){
  partyMembers = data.members || [];
  partyMessages = data.messages || [];
  chatBox.innerHTML = "";
  partyMessages.forEach(m => appendMessage(m));
}

// --- WebSocket ---
ws.onopen = ()=>console.log("Connected to WebSocket server");
ws.onmessage = e=>{
  try {
    const data = JSON.parse(e.data);
    if(data.type==="partyUpdate" && data.party===party){
      loadPartyData(data);
      playMessageSound();
    }
    if(data.type==="roomAnnounce"){
      if(!publicRooms.includes(data.party)) publicRooms.push(data.party);
    }
  } catch(err){ }
};

// --- Party actions ---
function createParty(){
  username = usernameInput.value.trim();
  partyType = partyTypeSelect.value;
  if(!username) return alert("Enter username");
  party = Math.random().toString(36).substr(2,5).toUpperCase();
  partyMembers = [username];
  partyMessages = [];
  appendMessage(`Party created! Code: ${party} (${partyType})`);
  broadcastParty();
  if(partyType==="public") alert(`Share this code to invite: ${party} (Public Party)`);
}

function joinParty(){
  username = usernameInput.value.trim();
  partyType = partyTypeSelect.value;
  party = partyInput.value.trim().toUpperCase();
  if(!username || !party) return alert("Enter username and party code");
  if(!partyMembers.includes(username)) partyMembers.push(username);
  appendMessage(`${username} joined the party`);
  broadcastParty();
}

function joinRandomParty(){
  username = usernameInput.value.trim();
  if(!username) return alert("Enter username");
  partyType = "public";
  if(publicRooms.length===0) return alert("No public rooms available");
  party = publicRooms[Math.floor(Math.random()*publicRooms.length)];
  partyMembers = [username];
  partyMessages = [];
  appendMessage(`${username} joined random public party ${party}`);
  broadcastParty();
}

// --- Messaging ---
function sendMessage(){
  const text = messageInput.value.trim();
  if(!text || !username || !party) return;
  const msg = `${username}: ${text}`;
  partyMessages.push(msg);
  appendMessage(msg);
  playMessageSound();
  messageInput.value = "";
  broadcastParty();
}

// --- Event Listeners ---
document.getElementById("create").onclick = createParty;
document.getElementById("join").onclick = joinParty;
document.getElementById("join-random").onclick = joinRandomParty;
document.getElementById("send").onclick = sendMessage;
messageInput.addEventListener("keypress", e=>{
  if(e.key==="Enter") sendMessage();
});
</script>
</body>
</html>
